	[TestFixture]
	public class AdventOfCode17
	{
		int[] bottles = new int[] { 43, 3, 4, 10, 21, 44, 4, 6, 47, 41, 34, 17, 17, 44, 36, 31, 46, 9, 27, 38 };
		//int[] bottles = new int[] { 20,15,10,5,5 };
		[Test]
		public void Part1()
		{
			Console.WriteLine(Combinations(0, 150));
		}
		[Test]
		public void Part2()
		{
			int minBot = bottles.Length;
			int comb = 0;
			MinContainerNumbers("", 0, 150, 0, ref comb, ref minBot);
			Console.WriteLine(comb);
			Console.WriteLine(minBot);
		}

		private int Combinations(int nextBottle, int spaceToUse)
		{
			if (spaceToUse < 0) return 0;
			if (nextBottle == bottles.Length) return spaceToUse == 0 ? 1 : 0;
			return
				Combinations(nextBottle + 1, spaceToUse - bottles[nextBottle]) +
				Combinations(nextBottle + 1, spaceToUse);
		}
		private void MinContainerNumbers(string s, int nextBottle, int spaceToUse, int bottlesCount, ref int combinationsCount, ref int minBottles)
		{
			if (spaceToUse < 0 || bottlesCount > minBottles) return;
			if (spaceToUse == 0)
			{
				Console.WriteLine(s);
				if (bottlesCount < minBottles)
				{
					minBottles = bottlesCount;
					combinationsCount = 1;
				}
				else if (bottlesCount == minBottles)
					combinationsCount++;
				return;
			}
			if (nextBottle == bottles.Length) return;
			MinContainerNumbers(s + " " + bottles[nextBottle], nextBottle + 1, spaceToUse - bottles[nextBottle], bottlesCount + 1, ref combinationsCount, ref minBottles);
			MinContainerNumbers(s, nextBottle + 1, spaceToUse, bottlesCount, ref combinationsCount, ref minBottles);
		}
	}


	[TestFixture]
	public class Advent18_Test
	{
		//		private string[] input =
		//		{
		//			"..",
		//			"##",
		//			"##",
		//		};
		private string[] input = {
			"####.#.##.###.#.#.##.#..###.#..#.#.#..##....#.###...##..###.##.#.#.#.##...##..#..#....#.#.##..#...##",
			".##...##.##.######.#.#.##...#.#.#.#.#...#.##.#..#.#.####...#....#....###.#.#.#####....#.#.##.#.#.##.",
			"###.##..#..#####.......#.########...#.####.###....###.###...#...####.######.#..#####.#.###....####..",
			"....#..#..#....###.##.#.....##...#.###.#.#.#..#.#..##...#....#.##.###.#...######......#..#.#..####.#",
			"..###.####..#.#.#..##.#.#....#......#.##.##..##.#.....##.###.#..###...###.#.##..#.#..###....####.#.#",
			"#.#...#......####.#..##.####.#.#.#...##..###.##.#...#..#..###....#.#....#..##..#....##.....##.#...#.",
			"....##.#.#.#.##..##...##..##..#....#....###...####.###...##.#...#..#....##.....#..#.#####.###.###.##",
			"#...##..#.#..#....#..########.##....##..##.###..#.#..#..#.##.##.#..##..######....####..#####.#.###..",
			".####...######.#..#.##.#.#..####...####.##.#.#......#...##....##..#...###..#.####......###......#.##",
			".####.###..#..#####.##...###......#...###..#..##..#.#....##.##.#.##.###..#..#..###.#..#.#....####.##",
			"#..#..##.##.##.###.#.##.##.#.#.#....#....#.####.#.##...#####...###.#####.#.#.#....####..###..###..##",
			"#.##....#...########..##...#.#.##.......#.#..##...####...#.####.####..##...##.#....###.#.####...#.##",
			"#.#...##..#.##.##..##....#.....##.##.....#...###...#..#...####.##.####..#...##..##.##.##.##..##...##",
			".#..###...#.#.....#######..##.###....##..#.##.#......###.##....#......###...#.##....#.....##......##",
			"..##....#.###...###..####.##..#..##.##......##.#.....#...#..#..##...###..#.####...#...#..##.#..##..#",
			"...#.#.#...#.#..#.##....##..#...#.##..#......#.#.....#####.##.#...#######.#.#..#.####..###.....###.#",
			".#....#.#.##..####.#####..#.#######..#.##.###...##.##....##..###..#.##.###.......#....#..######.####",
			"#..#.##.##..#..#..##.####.#.#.#.#..#.##...#..######....#.##.#..##.##.######.###.###.###...#.....#.#.",
			".#.......#...#.####.##...#####..##..#.#....##..#.#.#.####.#.##....#..##.##..#.###.....#.##.##.#.##.#",
			"#..##..##...#....#.##.#...#.#....#......####...##..#...##.##.#..#########..#..#.##.##..#.#.#######..",
			"#.......#####..###..######.#..##.#.#####..##...###...#.####.##...###..#.#.#####....#...#.##...#.#..#",
			".##..#...#####.##.##......#...#.#.#.###.#.#.#...##.#..#....###.....#..#.#.###......#####.###.#..##.#",
			".....###.#.#.#..##...#...###..#...#.#.##..###.##.#####.##..#.#.#.#.#####....#.#.#####...##.#..#.#.#.",
			"###...##.#..#.####..##.#..##.#.#.#...#.#..#..##..##..#.#.#.#.##...##..#..#.....#....#####.#.#.####.#",
			"....##....#.#.....#...###.#...##..##.##..#..###..##.###..#####..#...#####.##.#..#.#.#.###...####.###",
			"##.##.##.#...#..#...........##.##.###.#...###.####.#..#..#...#..#..####.#.###########..#.###.###.#.#",
			"##.##..##.####..###...##...#....###.###.#..##..#..#.###.#..####.#..##.#.#...#..#.#.##.##...#...#....",
			"..##...#.#.##....##...#.#.#......##.##.#.#.####.####....####.#.###.##.#.#..####..#..######..#..#.#..",
			"####.#.##.......##.###....##.#..####.#.#######..#...###..##.##..#...#...####........#.#..##...#....#",
			"#..#.#.....#..#.###..#.#...###..##...#.#..#.#.##..#...##.##.##.#.#.#..#.####.########....########..#",
			"#...#..##.##..#.#.#.##.##.##.#..#..#.##....#....###.#.###.#.#..#....#...##..#.....####...##.#..#...#",
			".###...##...####....###.##.#..####...##.#.##.#..##..##....#....##.#...#..#..##..##..##.#...#...###..",
			".#..##.#..##..####..#.#.##..###.#...#....##.###...#.###....#.#.#........#..#.#.#..##..#####..#..#.#.",
			".#.##.....#..#...#.##.....#.##..#..#....#..#..#....#.##..##...#.##.##..##..#.#.#.##..####.##..#.#..#",
			"...###.#.....#...#.##.#.###.#...##..#.###..#..#..#.#..#...###.#.##.##.##.#.##.#####.#..#.#..#.#...##",
			"#.#.#.#.##.#.....##..#.###......##.#.##..#...#.########.##.###..#..#..##..##.#..##..###.#.###...#.#.",
			"..##...##...#...###.#..##..#..#..#.#.##..##......##..##.....##.....####..#.##......#..####...###..##",
			"##.......#..##....###...###......#.##.##....######..###.##...##.#...#...#.....#.###.#.#..#.##..#..#.",
			"#.#..#..#.#####.##.##.###..#...###.....#..##..####...#.#.###....#..#.#.###.####..#.#........##.#....",
			"..###.#...##.#.####.#.##.##.....##...#.##.#.###.#.#..##.#..##..#..##.##....#.#####.##..#######.....#",
			"###.###..##.#..##...#####..##.####....#.##......##......#.#....##.####.#.#.#.###...#..####..#.######",
			"#..###...#.#.......#..####.####...#....###.###...#.##..##..#..##.##.......####.##...#.#.#.##.#.#..#.",
			"..#...#..###.##..#.#.#.##..#..#.#.......###..###..#####.#.#.#.#.#..#.#.#.#..###....#.####..###...#..",
			"...######.###....#..####.####......#...#.###.#....#...####.##........##...##.#..##.###.#..#..##..###",
			".#..###.####.###.#.#..#..#..#.##.#.#.###.##..####.#####..##....##.#.##...###.####.#.#######.#..#..#.",
			".#..##.#..##..#...##...#..#..##.#.#....##.##...###.#.#...##..##..#.###.#.#.#.#...#....#.#..#.#.###.#",
			".###..#.#..####.#########...####....####.#.##...##.##..#.##.#........#.....###.###.######.##.....###",
			"..##.##..##..#.####.#..#####.#....##.##.#####.....#.#......##...#####..####....###..#.#...#..####..#",
			".#..##..##.##.##.##.#.###.###.#..#..#...###.#.##..##...##...###...##.###..#.#.#####.#.#.##....#.##..",
			"...#.#....##.#.....###.##...#..##....#...###....#..#.###...##.#...###.#....#...##..###.#.....##....#",
			".#######..#...##.#.###.##.#.###...##......#.###.#...#.###.#.#.#..#..#####..#########...##..##...#..#",
			".#..#.##...#.#..#.##..#.#.#.##.....####.#..#.###..##.#.#.#...#....#.#..##.######...#.#..##.##...#..#",
			"#.#######.#####..#####.##.##.#.#.##.###..#....####.#..##.##.######..###...#.#..#.####.##.##....####.",
			"...##..#...##..#..#.....#.##...#.....##.#####.###.########.######..#...###..#.##.#.#.##..#.#.##..##.",
			"#..#..#.#....###.#...##..####.#.##..#.####.###..##.#...#.###.#..#.##..#######.#...#..#.#..##.#....##",
			"..#.##.#.####..##.###.###..#.##.#.####..##....##.###.#..##.#.###.###.##.##.#####..#.#...########....",
			".#.#.###..###...#...#..##.##......#..#...#.#.#.######.#.#...##..##........#....###..##...#..##.##...",
			"##..#....##.###...##.#.##.##.##..#....#.#.#..#..####.##..#...#...#..#..#####.###...#..###..#...#.#..",
			"##.#.#.##.###.....######.#.....#...#.##....###.#.##.#.#.##..##.######.#####....#.#####...##.#..###.#",
			"######.#...####..###..##..#..##...#.#....##.#...##...#.....#...##....#.##..###..###...###..#..######",
			".....##.........#####.#.##..#..#.#.#.#.##...#....#.....###.########...#..####..#...#...##..#.##.##.#",
			"#..###...#.##.##.#.#..####.#.....##..###....##..#...#.#...##.##..###..####...#.####..##..#..##..#...",
			"#.####.#..##.#..#.....#..#.#..###...######.#.........####....###..#.#.#.##.#..#...#..####.....##..#.",
			"..##....#.###.......##.#...#.####..##....##.#..#....#######...####.##..#####.#.#.#.#.##..##..#.#.#..",
			"#.#.#.###..#..#.#..#.#.###....#...#####.###...........#.#....#####...#..####....#...###.#..#..####..",
			".......#.####.##...#..#.##..###..#..#.#.#.#.###....#....#.#.#..#.#..##.#####.#.....#.##.#.###.###.##",
			"..###...#..#...####.#..##..##.#.#..#...#.#..#....###.#..####..######...####.#.##..#.#..###...##.####",
			"..#.###..#.#...##...#.#....#..#...#.#..##.######.######.#.##.....#..##.#..###..#..#.##.###...#..#.##",
			"####..##.####.....#...#.#.###..#...####.###.#.#.#.......##...#....#..#....#.#......###...#####.#.##.",
			"#..##..#..#.####...#####.#.###.##.#.##.....#.#..#.##........######.#.#.###....##.##..##..########.##",
			"#.#....###.##....#######.#...#.#.#.#..##.#.##...#.###...#.#.#..#.#..####.#.#..#..#.##.####....#..##.",
			"####.##....#.......###..#..##.#.#.##..#...#...##.###....##..###.#.#...#..#.....##.###.##...###....##",
			"..##.#..#....######..#.##.#.#...##..####.#####...##.#..###.##...#..####..###.##..##.##.#####.#..#.#.",
			".#.##..#..##.#.###.###....#.#..#....#...###.##.#.#.####.....#....#...#.....#....#.#.###.#..#.##..###",
			"..###.#.#.##...##.##.##.#...#####.#..##.#....##..####...###..#....#.##...#........#####.#.###.#..#..",
			"....#..##..##....#.#....#.#..##...##.#...##.###.#.#..###..##.##.##..#.#.#..#.#.##.......#.##.###..#.",
			".#..##.##.####.##....##.##.....###..##.#.##...#..###....###.###....#.#....#....#.##.#.##.#.##.....##",
			"#.#..#.##.###.#.######.....###.#..#...#.#.....##.###.#...#.#..###.#.....##.###.#.###.####..#####.#..",
			"#.#.##......#.##.#.#..##....#..###.#.###...##...###.#..#.##...#..#.##..##.#...######.##.....#####.##",
			"#.#..#####....###.###...#.......#....###.##...#..#.##..#...#####..#..#.##......###...#...###..#.#..#",
			"#.##..##.##.#..#.##.##..#.###.##.........###.#.#..#.#.....#.#...#.#.##.#.##.#...#...####.#.......##.",
			".#...####.##..#..##....####..######...#.#..##.##.....#####.#...#..#.####.#######...#.#####..#.###...",
			".#..######.#.##..##...##.....###.#..##..#...####..###...###.###..#..######.#....########..#####...#.",
			"#..##.......#####...###..#.#.##.#..###.#...##.#..#.##.###...###...##.#..##..########..#.#..##..#.###",
			".#.#..#...#.#..#..##...#.#.##...###..#..#....###.#....#.##....###.###..##..#.#.####..####.#######.##",
			"...##..##.##.###.##.###...##.#.#.....##.####..#..##.#..#.####...##..#..#.##...##...###.##.#.......##",
			".#.....#.##..#.#.....#.##.##..###..#....###...#.#....##########.##.###.#...#.####..####.#..#.#..###.",
			".##.#.#.##..#..###.###.##.#########.#.#.#.#.##.###..##..#.##.####......#####...#..####.#.##..#####.#",
			"..#....###...##....#.###..##..#..####.##..####.#..####.###.#....####.....#.###..##...##..####...##.#",
			".###.....###.##.##..###.###.....##..#.######.#.#..##..#.##.#..#.#.#....#...#.#.#...#...##....#..##.#",
			"..##....#..#####....#..####.#.#...##.#....##..##.###.###....###......#...#.#####.......#...#.....###",
			"###.#..#.#.##..#..#...#.#....###.##.#.###.#...#.##.#..#.#.......#.#.#.###.####.###....#..##..#####..",
			".#..#######.#..###.#.##.#####.#####...##..#.####.#.#.##..###...#..##.##..#.#.###..#....#..#...###.#.",
			"..#####..#.##.....###..##.#...#.#.#..#######.#..#...#.##.##.#.#....####...###..##...#....####.#..#.#",
			".####..#.#.##.###.#.##.....#..##.#.....###.....#..##...#....###.###..#......###.#.#.#.##.#.##..#...#",
			"##.#..##.#..##...#.#....##..######..#.....#..#...#####....##......####.##..#...##..#.##.#.#######..#",
			"##..####.#...##...#.#####.#.#..#....#.#..##.####.#..######.#..#..#.......#####..#..#..###.##...##.##",
			"#.####......#.###...#..####.#..##.##..#.#...##.###.#...#####..####.#..#.#.....#.##...###...#.#....##",
			"###.#.#.##.######......#.#.#.#.#........#..#..###.#.#.#..#.........#..#....#.#..#..#..###.##......##",
			"##.#########...#...###..#.###.....#.#.##.........###....#.####.#...###.#..##..#.###..#..##......#.##",
		};
		[Test]
		public void Part1()
		{
			var map = new[] { new char[input[0].Length + 2] }.Concat(input.Select(s => ("." + s + ".").ToArray())).Concat(new[] { new char[input[0].Length + 2] }).ToArray();

			var aliveCount = map.Sum(s => s.Count(c => c == '#'));
			Console.WriteLine(aliveCount);
			for (int i = 0; i < 100; i++)
			{
				map = Life(map);
				aliveCount = map.Sum(s => s.Count(c => c == '#'));
				Console.WriteLine(aliveCount);
			}

		}

		private char[][] Life(char[][] map)
		{
			char[][] m2 = Enumerable.Range(0, map.Length).Select(i => new char[map[0].Length]).ToArray();
			for (int x = 1; x < m2.Length - 1; x++)
				for (int y = 1; y < m2[0].Length - 1; y++)
				{
					var ns = 0;
					for (int xx = x - 1; xx <= x + 1; xx++)
						for (int yy = y - 1; yy <= y + 1; yy++)
							if ((xx != x || yy != y) && (map[xx][yy] == '#'))
								ns++;
					m2[x][y] = (ns == 3 || ns == 2 && map[x][y] == '#') ? '#' : '.';
				}
			m2[1][1] = '#';
			m2[1][m2[0].Length - 2] = '#';
			m2[m2.Length - 2][m2[0].Length - 2] = '#';
			m2[m2.Length - 2][1] = '#';
			return m2;
		}
	}